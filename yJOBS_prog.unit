#!/usr/local/bin/koios
#   koios-polos (axis of heaven) unit testing meta-language



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
PREP          include the prototype headers                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include public header                yJOBS.h                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include private header               yJOBS_priv.h                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP          (PROG) verify registering and withdrawing in driver                yJOBS_driver                                                                                          ((06.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       verify program setup                                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     initialize the system                yjobs__unit_quiet                                                                                                                 i_equal     0                                                                                                    
     local    create working variable              - - - - - - - - - - - - -   int     i        =  1;                                                                                                                                                                                                     

   COND       prepare directory environment                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     local    create working variable              - - - - - - - - - - - - -   char    x_curr   [LEN_PATH]  = "";                                                                                                                                                                                         
     code     save home path                       - - - - - - - - - - - - -   getcwd (x_curr, LEN_PATH);                                                                                                                                                                                                 
     exec     create directories                   yJOBS_mkdirs                                                                                                                      i_equal     0                                                                                                    
     exec     show world file is missing           yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     -1                                                                                                   

   COND       set up as metis testing                                            - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call runas                           yjobs_runas                 "metis_unit"         , NULL                                                                           i_equal     0                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (M) metis-okeanides ¬¬, ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬, ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬  

   COND       set up registration action                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call arg finder                      yJOBS_argument              &i     , "--register"         , "interesting.tasks"                    , NULL   , NULL    , NULL      i_equal     1                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (M) metis-okeanides ¬¬, run (b) register (silent) , åinteresting.tasksæ       

   COND       attempt to register missing file                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change directory                     - - - - - - - - - - - - -   chdir  ("/tmp/home/member/");                                                                                                                                                                                              
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_lesser    0                                                                                                    
     exec     show world file is missing           yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     -1                                                                                                   

   COND       verify handles register action                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     create a sample file                 yURG_touch                  "/tmp/home/member/interesting.tasks"              , "member"         , "member"         , "0600"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     0                                                                                                    
     exec     ... review world count               yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     1                                                                                                    
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 0                                                        s_equal     /tmp/home/member/interesting.tasks                                                                   
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 1                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 2                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 3                                                        s_equal                                                                                                          
     exec     remove a sample file                 yURG_rm                     "/tmp/home/member/interesting.tasks"                                                                  i_equal     0                                                                                                    

   COND       attempt to create duplicate registration                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.007))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     create a sample file                 yURG_touch                  "/tmp/home/member/interesting.tasks"              , "member"         , "member"         , "0600"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     1                                                                                                    
     exec     ... review world count               yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     1                                                                                                    
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 0                                                        s_equal     /tmp/home/member/interesting.tasks                                                                   
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 1                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 2                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 3                                                        s_equal                                                                                                          
     exec     remove a sample file                 yURG_rm                     "/tmp/home/member/interesting.tasks"                                                                  i_equal     0                                                                                                    

   COND       attempt to unregister a missing file                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.008))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call runas                           yjobs_runas                 "metis_unit"         , NULL                                                                           i_equal     0                                                                                                    
     exec     call arg finder                      yJOBS_argument              &i     , "--withdraw"         , "interesting.tasks"                    , NULL   , NULL    , NULL      i_equal     1                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (M) metis-okeanides ¬¬, run (q) withdraw (silent) , åinteresting.tasksæ       
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_lesser    0                                                                                                    
     exec     ... review world count               yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     1                                                                                                    
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 0                                                        s_equal     /tmp/home/member/interesting.tasks                                                                   
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 1                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 2                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 3                                                        s_equal                                                                                                          

   COND       verify handles withdraw action                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.009))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     create a sample file                 yURG_touch                  "/tmp/home/member/interesting.tasks"              , "member"         , "member"         , "0600"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     0                                                                                                    
     exec     ... review world count               yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     0                                                                                                    
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 0                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 1                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 2                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 3                                                        s_equal                                                                                                          
     exec     remove a sample file                 yURG_rm                     "/tmp/home/member/interesting.tasks"                                                                  i_equal     0                                                                                                    

   COND       attempt to unregister an already unregistered                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.010))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     create a sample file                 yURG_touch                  "/tmp/home/member/interesting.tasks"              , "member"         , "member"         , "0600"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     1                                                                                                    
     exec     ... review world count               yURG_peek_count             "/tmp/lib/metis/world.txt"                                                                            i_equal     0                                                                                                    
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 0                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 1                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 2                                                        s_equal                                                                                                          
     exec     ... review world                     yURG_peek                   "/tmp/lib/metis/world.txt"                 , 3                                                        s_equal                                                                                                          
     exec     remove a sample file                 yURG_rm                     "/tmp/home/member/interesting.tasks"                                                                  i_equal     0                                                                                                    

   COND       return proper directory environment                                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.011))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change directory                     - - - - - - - - - - - - -   chdir  (x_curr);                                                                                                                                                                                                           
     exec     remove directories                   yJOBS_rmdirs                                                                                                                      i_equal     0                                                                                                    

   COND       verify program teardown purges                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.012))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up                              yjobs__unit_end                                                                                                                   i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP          (PROG) verify checking and fixing security in driver               yJOBS_driver                                                                                          ((06.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       verify program setup                                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     initialize the system                yjobs__unit_quiet                                                                                                                 i_equal     0                                                                                                    
     local    create working variable              - - - - - - - - - - - - -   int     i        =  1;                                                                                                                                                                                                     

   COND       prepare directory environment                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     local    create working variable              - - - - - - - - - - - - -   char    x_curr   [LEN_PATH]  = "";                                                                                                                                                                                         
     code     save home path                       - - - - - - - - - - - - -   getcwd (x_curr, LEN_PATH);                                                                                                                                                                                                 
     exec     create directories                   yJOBS_mkdirs                                                                                                                      i_equal     0                                                                                                    

   COND       set up as metis testing                                            - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call runas                           yjobs_runas                 "heracles_unit"      , NULL                                                                           i_equal     0                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (H) heracles-promachus, ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬, ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬  

   COND       set up audit action                                                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call arg finder                      yJOBS_argument              &i     , "--audit"            , NULL                                   , NULL   , NULL    , NULL      i_equal     1                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (H) heracles-promachus, run (a) audit (silent)    , åæ                        

   COND       verify handles action                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     0                                                                                                    

   COND       attempt with wrong owner                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     update owner                         yURG_touch                  "/tmp/spool/heracles/"                            , "member"         , "root"           , "0700"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_lesser    0                                                                                                    

   COND       attempt with wrong permissions                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     update owner                         yURG_touch                  "/tmp/spool/heracles/"                            , "root"           , "root"           , "0755"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_lesser    0                                                                                                    

   COND       resetup as fix action                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call runas                           yjobs_runas                 "heracles_unit"      , NULL                                                                           i_equal     0                                                                                                    
     exec     call arg finder                      yJOBS_argument              &i     , "--fix"              , NULL                                   , NULL   , NULL    , NULL      i_equal     1                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (H) heracles-promachus, run (f) fix (silent)      , åæ                        

   COND       verify handles action                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     0                                                                                                    

   COND       set up as metis testing                                            - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call runas                           yjobs_runas                 "hypnos_unit"        , NULL                                                                           i_equal     0                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (Y) hypnos-epidotes ¬¬, ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬, ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬  

   COND       set up audit action                                                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call arg finder                      yJOBS_argument              &i     , "--audit"            , NULL                                   , NULL   , NULL    , NULL      i_equal     1                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (Y) hypnos-epidotes ¬¬, run (a) audit (silent)    , åhypnos.confæ                        

   COND       verify handles action                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     0                                                                                                    

   COND       attempt with wrong group                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     update owner                         yURG_touch                  "/tmp/etc/"                                       , "root"           , "users"          , "0700"      i_equal     0                                                                                                    
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_lesser    0                                                                                                    

   COND       resetup as fix action                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call runas                           yjobs_runas                 "hypnos_unit"        , NULL                                                                           i_equal     0                                                                                                    
     exec     call arg finder                      yJOBS_argument              &i     , "--fix"              , NULL                                   , NULL   , NULL    , NULL      i_equal     1                                                                                                    
     get      ... run modes                        yjobs_base__unit            "mode"                                                                                                s_equal     BASE mode        : iam (Y) hypnos-epidotes ¬¬, run (f) fix (silent)      , åhypnos.confæ                        

   COND       verify handles action                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call the driver                      yJOBS_driver                NULL, NULL                                                                                            i_equal     0                                                                                                    

   COND       return proper directory environment                                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.011))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change directory                     - - - - - - - - - - - - -   chdir  (x_curr);                                                                                                                                                                                                           
     exec     remove directories                   yJOBS_rmdirs                                                                                                                      i_equal     0                                                                                                    

   COND       verify program teardown purges                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((06.012))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up                              yjobs__unit_end                                                                                                                   i_equal     0                                                                                                    



